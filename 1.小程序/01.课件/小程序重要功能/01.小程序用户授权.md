# 小程序用户授权

1. 截至到22/2/19为止,小程序一共出现了三种授权方式
2. 首次登录用户授权
   1. 早期
      1. API:wx.getUserInfo({})
      2. 在小程序早期时,只要调用该API就会弹出授权窗口,找用户获取个人信息
      3. 由于该API被过渡滥用,不利于小程序发展,所以最终小程序官网将该API进行限制,只能在用户已经授权过的情况下才能使用
   2. 中期
      1. 于21/4/10左右,开始正式废弃,开始使用最新版本
         1. **注意:想要测试该功能,需要将基础库版本调至2.15.0以下**
      2. 流程:
         1. 给页面上的button组件添加标签属性open-type,属性值为getUserInfo,从而实现授权弹窗效果
         2. 给button组件绑定事件监听,事件名:getuserinfo
         3. 在事件回调函数中,可以通过形参中的detail属性获取到用户相关数据(如果res.detail.userInfo有值就说明用户授权成功)
         4. 将res.detail中的userInfo对象更新到data中
         5. 在wxml中,使用data中的userInfo对象数据进行动态渲染
   3. 最新
      1. **API:wx.getUserProfile({})**
      2. **流程:**
         1. **给页面上的某个组件绑定tap事件**
         2. **在事件的回调函数中,调用wx.getUserProfile方法,获取到用户个人信息**
         3. **将数据更新到data中进行展示**
      3. **注意点:**
         1. **该API必须在用户触发tap事件的回调函数中调用才能执行,否则无效**
         2. **该API必须在2.15.0版本及以上才能使用**
         3. **配置对象中的desc属性必传,否则该API无效**
         4. **每次调用该API都会弹出授权窗口,再加上wx.getUserInfo方法已经废弃,所以如果想要实现二次登录免授权功能,就需要在授权成功之后,将用户信息存储到Storage(本地存储)中,在二次登录的时候,读取出来使用**
3. 用户二次登录免授权(又称为**静默登录**)
   1. 需求:当用户进入首页时,自动获取用户信息,并进行展示
   2. 拆解:
      1. 当用户进入首页时
         1. 会触发首页进入阶段的所有生命周期->onLoad
      2. 自动获取用户信息
         1. 使用js的API获取用户信息
         2. API:wx.getUserInfo({})
         3. **注意:该API必须在用户已经经过首次授权逻辑之后才能使用,否则无效**
      3. 在页面上进行展示
         1. 将数据更新到data中,wxml就会自动展示最新数据
4. 奇特的组件
   1. 组件名:open-data
   2. 这个组件很鸡肋,能看不能用,该组件可以显示用户的部分个人信息,但是开发者无法从该组件上提取到数据
   3. 据官网所示,open-data的权限即将被收回,也就是说后面小程序开发,该组件将无法使用